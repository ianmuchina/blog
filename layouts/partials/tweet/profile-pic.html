<!--
    Renders profile Picture

    params:
    "ctx" - valid tweet object
    "use_base64" - flag to inline the image as base64 data uri
    "size" size based on the following

    valid size values:
    '_mini'   -> '24x24' 
    '_normal' -> '48x48'
    '_bigger' -> '73x73'
    ''        -> 'original' || 400x400
-->

{{/*
== TODO ==
- avif & webp variants (via shell script)
- save to 'assets/twitter/users/{user-id}.{png|webp|avif} 
- multiple size variants
*/}}


{{ with .ctx }}
    {{/* Source */}}
    {{ $url := replace .user.profile_image_url_https "_normal" "" }}
    {{/* Download */}}
    {{ $img  := resources.GetRemote $url }}
    {{ if eq $.size "_mini" }}
        {{ $img = $img.Resize "36x36 webp q100 picture" }}
    {{ else }}
        {{ $img = $img.Resize "100x100 webp q90" }}
    {{ end }}

    {{/*  Generate filenames */}}
    {{ $dir  := "/twitter/media/profile_images/"}}
    {{ $filename      := print $dir .user.id_str $.size "." $img.MediaType.SubType  }}
    {{/*  Rename  */}}
    {{ $img = $img.Content | resources.FromString $filename }}

    <picture>
        {{/*  <source srcset="{{ $webp.RelPermalink }}" type="{{ $webp.MediaType }}">  */}}
        <source srcset="{{ $img.RelPermalink  }}" type="{{ $img.MediaType  }}">
        <img
            width="42"
            height="42"
            loading="lazy"
            alt=""
            src="{{ $url }}"
        />
</picture>
{{ end }}