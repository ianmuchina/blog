{{/* Get retweet count from secondary source */}}
{{ $Bearer := "AAAAAAAAAAAAAAAAAAAAANRILgAAAAAAnNwIzUejRCOuH5E6I8xnZz4puTs=1Zv7ttfk8LF81IUq16cHjhLTvJu4FA33AGWWjCpTnA" }}
{{ $headers := dict "Authorization" (print "Bearer " $Bearer) }}
{{/* Get Guest Token */}}
{{ $response := resources.GetRemote "https://api.twitter.com/1.1/guest/activate.json" (dict "method" "post" "headers"  $headers) }}

{{ $j := $response.Content | transform.Unmarshal }}
{{ $GuestToken := index $j "guest_token" }}

{{ $headers := (dict "Authorization" (printf "Bearer %s" $Bearer) "X-Guest-Token" (printf "%v" $GuestToken)) }}

{{ $url := print "https://api.twitter.com/1.1/statuses/lookup.json?include_entities=1&id=" .ctx.id_str }}

{{ with resources.GetRemote $url (dict "method" "get" "key" (print "v1-lookup" .ctx.id_str) "headers"  $headers) }}
  {{ with .Err }}
    {{ warnf "%v" . }}
  {{ else }}
    {{ with .Content | transform.Unmarshal }}
      {{ $j = index . 0 }}
    {{ else }}
      {{ warnf "Err %s" .ctx.id_str }}
    {{ end }}
  {{ end }}
{{ end }}

{{ $link := print "https://twitter.com/" .ctx.user.screen_name "/status/" .ctx.id_str }}


<div class="tweet-buttons-thread">
  <a href="{{ $link }}" class="blue">
    {{ partial "inline-svg" "twitter/comment" }}
    {{ partial "tweet/compact" .ctx.conversation_count }}
  </a>
  <a href="{{ $link }}" class="green">
    {{ partial "inline-svg" "twitter/retweet" }}
    {{ partial "tweet/compact" $j.retweet_count }}
  </a>
  <a href="{{ $link }}" class="red">
    {{ partial "inline-svg" "twitter/like" }}
    {{ partial "tweet/compact" .ctx.favorite_count }}
  </a>
  <a href="{{ $link }}" class="blue">
    {{ partial "inline-svg" "twitter/share" }}
  </a>
</div>
