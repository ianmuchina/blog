<!--
  Renders images from a tweet object
  Size values:
    `:thumb`
    `:small`
    `:medium`
    `:large`
    `:orig`

  TODO: Custom quality based on above.

 TODO params loading:
    size: {small, medium, large, original}
    backup: {true, false, }
-->

{{ with .ctx.photos }}
  {{ $count := len . }}
  <div class="gallery gallery-{{- $count -}}">
    {{ $i := 1 }}
    {{ range  . }}
      {{ $src := printf "%s:medium" .url }}
      {{ $lg_src := printf "%s:medium" .url }}
      {{ $pic_id := print  "-" $i }} {{ if eq 1 $count }} {{ $pic_id = ""}} {{ end }}

      {{/*  Download Image  */}}
      {{ $img := resources.GetRemote .url }}
      {{ $img := $img.Resize "1280x webp q80" }}
      {{ $filename := print "/twitter/media/photos/" $.ctx.id_str $pic_id "." $img.MediaType.SubType }}
      {{ $img := $img.Content | resources.FromString $filename }}
      {{ $webp := $img.Resize "1000x webp q90" }}
      {{/*
        {{/*  Webp */}}
        {{/*
        {{ $filename2 := print "/twitter/media/photos/" $.ctx.id_str $pic_id ".webp"  }}
      */}}
      {{/*  {{ $webp := $webp.Content | resources.FromString $filename }}  */}}
      {{/*  {{ $webp := slice $webp | resources.Concat $filename2 }}  */}}

      {{ $i = add $i 1 }}
      <picture>
        {{/*  Webp Variant  */}}
        {{/*  <source srcset="{{ $webp.RelPermalink }}" type="{{$webp.MediaType}}">  */}}
        {{/*  Default  */}}
        <source srcset="{{ $img.RelPermalink }}" type="{{$img.MediaType}}">

        {{/*  Fallback  */}}
          <img
            src="{{ .url }}"
            {{ if eq 1 $count }}
              width="{{ .width }}"
              height="{{ .height }}"
              style="aspect-ratio: {{.width}}/{{.height}}"
            {{ end }}
            {{ if .accessibilityLabel }}
              alt='{{.accessibilityLabel}}'
            {{ else }}
              alt=""
            {{ end }}
          />
        </picture>
    {{ end }}
  </div>
{{ end }}